<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cartoon Fly Commander</title>
  <style>
    :root {
      --bg: #0f172a;           /* slate-900 */
      --panel: #111827;        /* gray-900 */
      --panel-2: #0b1220;      /* darker */
      --accent: #60a5fa;       /* blue-400 */
      --accent-2: #22d3ee;     /* cyan-400 */
      --text: #e5e7eb;         /* gray-200 */
      --muted: #94a3b8;        /* slate-400 */
      --success: #34d399;      /* green-400 */
      --warn: #fbbf24;         /* amber-400 */
      --danger: #f87171;       /* red-400 */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1000px 500px at 70% -10%, #1f2937 0%, var(--bg) 40%, #0b1020 80%);
      color: var(--text);
    }
    .app { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    header { display:flex; align-items:center; gap:12px; margin-bottom: 12px; }
    h1 { font-size: clamp(20px, 3.4vw, 28px); margin: 0; letter-spacing: .5px; }
    .badge { font-size: 12px; padding: 2px 8px; border-radius: 999px; background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: #001018; font-weight: 700; }

    .shell { display:grid; grid-template-columns: 1fr 360px; gap: 16px; }
    @media (max-width: 900px) { .shell { grid-template-columns: 1fr; } }

    .playground {
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border: 1px solid #1f2937; border-radius: 16px; overflow: hidden; position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);
      min-height: 520px;
    }

    .controls {
      background: linear-gradient(180deg, #0e1425 0%, #0b0f1a 100%);
      border: 1px solid #1f2937; border-radius: 16px; padding: 16px; position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .row { display:flex; gap:8px; flex-wrap:wrap; margin-bottom: 10px; }
    input[type="text"] {
      flex: 1 1 200px; background: #0b1220; border: 1px solid #23304b; color: var(--text);
      padding: 12px 12px; border-radius: 10px; outline:none; font-size: 14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    input[type="range"] { width: 140px; }

    button {
      background: linear-gradient(90deg, #1f2a44, #1b2540);
      color: var(--text); border: 1px solid #23304b; padding: 10px 14px; border-radius: 10px;
      cursor: pointer; font-weight: 600; letter-spacing: .2px; transition: transform .06s ease, box-shadow .2s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.03);
    }
    button:hover { box-shadow: 0 10px 22px rgba(0,0,0,.3); }
    button:active { transform: translateY(1px); }

    .btn-primary { background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: #012;
      border: none; }
    .btn-ghost { background: #0b1220; }

    .legend {
      font-size: 13px; color: var(--muted); margin-top: 8px; line-height: 1.4;
    }
    .status { margin-top: 8px; font-size: 13px; color: #c7d2fe; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; background:#131c32; border:1px solid #223157; color:#a5b4fc; font-weight:700; font-size:12px; }

    /* Stage SVG */
    #stage { width: 100%; height: 100%; display:block; }
    .grid-line { stroke: #1d263f; stroke-width: 1; opacity: .5; }
    .grid-line.major { stroke-width: 1.5; opacity: .75; }

    .hud {
      position: absolute; left: 12px; top: 12px; font-size:12px; color:#9fb6ff;
      background: rgba(9,14,24,.55); border:1px solid rgba(96,165,250,.25); padding:8px 10px; border-radius:10px;
      backdrop-filter: blur(4px);
    }
	textarea#commandInput {
	width: 100%;
	min-height: 100px;      /* base height (about 5 lines) */
	max-height: 200px;     /* optional: stop it from getting too tall */
	padding: 12px;
	font-size: 16px;
	border-radius: 10px;
	resize: vertical;      /* let the user drag to resize */
	overflow-y: auto;      /* show scrollbar if needed */
	background: #0b1220;
	border: 1px solid #23304b;
	color: var(--text);
	}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Cartoon Fly Commander</h1>
      <span class="badge">Type commands, watch it fly</span>
    </header>

    <div class="shell">
      <div class="playground">
        <div class="hud"><span class="pill" id="hudAngle">θ 0°</span> &nbsp; <span class="pill" id="hudPos">(0, 0)</span> &nbsp; <span class="pill" id="hudWings">wings: folded</span></div>
        <svg id="stage" viewBox="0 0 560 560" preserveAspectRatio="xMidYMid slice" aria-label="fly stage">
          <!-- background -->
          <defs>
            <linearGradient id="bg" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="#0f1a2e"/>
              <stop offset="100%" stop-color="#0a0f1d"/>
            </linearGradient>
            <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="2"/>
            </filter>
          </defs>
          <rect x="0" y="0" width="560" height="560" fill="url(#bg)"/>

          <!-- grid -->
          <g id="grid">
            <script type="application/ecmascript"><![CDATA[
              // draw grid programmatically inside SVG for crispness
              const g = document.currentScript.parentElement;
              const W=560,H=560, minor=40, major=160;
              for (let x=0;x<=W;x+=minor){
                const line = document.createElementNS('http://www.w3.org/2000/svg','line');
                line.setAttribute('x1',x); line.setAttribute('x2',x); line.setAttribute('y1',0); line.setAttribute('y2',H);
                line.setAttribute('class','grid-line' + (x%major===0?' major':''));
                g.appendChild(line);
              }
              for (let y=0;y<=H;y+=minor){
                const line = document.createElementNS('http://www.w3.org/2000/svg','line');
                line.setAttribute('y1',y); line.setAttribute('y2',y); line.setAttribute('x1',0); line.setAttribute('x2',W);
                line.setAttribute('class','grid-line' + (y%major===0?' major':''));
                g.appendChild(line);
              }
            ]]></script>
          </g>

          <!-- shadow under the fly -->
          <ellipse id="flyShadow" cx="480" cy="280" rx="20" ry="8" fill="#000" opacity=".25" filter="url(#shadow)" />

          <!-- The Fly (centered at 0,0; pointing to +X) -->
          <g id="fly" transform="translate(480 280) rotate(0)">
            <!-- wings (behind body) -->
            <g id="wings" opacity=".9">
              <ellipse id="leftWing" cx="-6" cy="-12" rx="16" ry="9" fill="#e5fbff" opacity=".7" stroke="#b7e8ff" stroke-width="1" transform="rotate(18 -6 -12)"/>
              <ellipse id="rightWing" cx="-6" cy="12" rx="16" ry="9" fill="#e5fbff" opacity=".7" stroke="#b7e8ff" stroke-width="1" transform="rotate(-18 -6 12)"/>
            </g>

            <!-- body -->
            <ellipse cx="0" cy="0" rx="18" ry="12" fill="#1f2937" stroke="#94a3b8" stroke-width="1.5"/>
            <ellipse cx="8" cy="0" rx="14" ry="10" fill="#111827" stroke="#6b7280" stroke-width="1"/>

            <!-- head -->
            <circle cx="18" cy="-2" r="7" fill="#0b1220" stroke="#60a5fa" stroke-width="1"/>

            <!-- eyes -->
            <circle cx="20.5" cy="-4" r="2.4" fill="#f8fafc"/>
            <circle cx="20.5" cy="1.8" r="2.4" fill="#f8fafc"/>
            <circle cx="21" cy="-3.6" r="1.2" fill="#0f172a"/>
            <circle cx="21" cy="1.4" r="1.2" fill="#0f172a"/>

            <!-- tiny antennae -->
            <path d="M16 -5 Q13 -10 10 -11" stroke="#60a5fa" stroke-width="1" fill="none"/>
            <path d="M16 -1 Q13 -6 10 -6" stroke="#60a5fa" stroke-width="1" fill="none"/>
          </g>
        </svg>
      </div>

      <div class="controls">
        <div class="row">
          <textarea id="commandInput" rows="5" placeholder="Type: a=forward, b=stop, c=left, d=right, e=extend wings"></textarea>
        </div>
        <div class="row">
          <button id="runBtn" class="btn-primary">Run Sequence</button>
          <button id="resetBtn" class="btn-ghost">Reset</button>
          <label style="display:flex;align-items:center;gap:8px;margin-left:auto;color:var(--muted);font-size:13px">
            Step Duration
            <input id="dur" type="range" min="120" max="1400" step="20" value="520"/>
            <span id="durLabel" class="pill">520 ms</span>
          </label>
        </div>
        <div class="legend">
          <strong>Commands:</strong>
          <span class="pill">a = go forward</span>
          <span class="pill">b = stop (wait)</span>
          <span class="pill">c = turn left</span>
          <span class="pill">d = turn right</span>
          <span class="pill">e = extend/retract wings</span>
          <div style="margin-top:6px">Examples: <code>aaacda</code>, <code>caaeddaabb</code>, <code>aeeaacca</code></div>
        </div>
        <div id="status" class="status">Ready. Enter a sequence and press <em>Run Sequence</em>.</div>
      </div>
    </div>
  </div>

  <script>
    // --- DOM refs ---
    const stage = document.getElementById('stage');
    const fly = document.getElementById('fly');
    const leftWing = document.getElementById('leftWing');
    const rightWing = document.getElementById('rightWing');
    const shadow = document.getElementById('flyShadow');

    const input = document.getElementById('commandInput');
    const runBtn = document.getElementById('runBtn');
    const resetBtn = document.getElementById('resetBtn');
    const dur = document.getElementById('dur');
    const durLabel = document.getElementById('durLabel');
    const statusEl = document.getElementById('status');
    const hudAngle = document.getElementById('hudAngle');
    const hudPos = document.getElementById('hudPos');
    const hudWings = document.getElementById('hudWings');

    const view = { W: 560, H: 560 };

    // --- Fly state ---
    const state = {
      x: view.W/2,
      y: view.H/2,
      angle: 0,         // degrees; 0 faces +X
      wingsExtended: false,
    };

    // --- Config ---
    const STEP_TURN_DEG = 30;       // per 'c'/'d'
    const STEP_FORWARD_PX = 60;     // per 'a'

    function toRad(deg){ return deg * Math.PI / 180; }

    // Update HUD and transforms
    function render() {
      fly.setAttribute('transform', `translate(${state.x.toFixed(2)} ${state.y.toFixed(2)}) rotate(${state.angle.toFixed(2)})`);
      // shadow follows (no rotation)
      shadow.setAttribute('cx', state.x.toFixed(2));
      shadow.setAttribute('cy', (state.y + 16).toFixed(2));

      hudAngle.textContent = `θ ${Math.round((state.angle%360+360)%360)}°`;
      hudPos.textContent = `(${Math.round(state.x)}, ${Math.round(state.y)})`;
      hudWings.textContent = `wings: ${state.wingsExtended? 'extended':'folded'}`;
    }

    // Keep fly inside view by wrap-around
    function wrap() {
	  const M = 0;
      if (state.x < -M) state.x = view.W + M;
      if (state.x > view.W + M) state.x = -M;
      if (state.y < -M) state.y = view.H + M;
      if (state.y > view.H + M) state.y = -M;
    }

    // Simple easing
    // function easeInOut(t){ return t<.5 ? 2*t*t : -1+(4-2*t)*t; }
	function easeInOut(t){ return t; }

    // Generic tween helper
    function tween(duration, onUpdate) {
      return new Promise(resolve => {
        const start = performance.now();
        function frame(now){
          const t = Math.min(1, (now - start) / duration);
          const e = easeInOut(t);
          onUpdate(e);
          render();
          if (t < 1) requestAnimationFrame(frame); else resolve();
        }
        requestAnimationFrame(frame);
      });
    }

    // Wing animation: rotate around each wing's base
    function setWingAngle(deg){
      leftWing.setAttribute('transform', `rotate(${deg} -6 -12)`);
      rightWing.setAttribute('transform', `rotate(${-deg} -6 12)`);
    }

    async function animateWings(extend, duration){
		const start = state.wingsExtended ? 46 : 14; // current angle
		const end   = extend ? 46 : 14;              // target angle
		const delta = end - start;
		await tween(duration, e => setWingAngle(start + delta * e));
		state.wingsExtended = extend;
	}

    // Command primitives
    async function cmdForward(duration){
      const rad = toRad(state.angle);
      const dx = Math.cos(rad) * STEP_FORWARD_PX;
      const dy = Math.sin(rad) * STEP_FORWARD_PX;
      const x0 = state.x, y0 = state.y;
      await tween(duration, e => {
        state.x = x0 + dx * e;
        state.y = y0 + dy * e;
        wrap();
      });
    }

    async function cmdStop(duration){
      await tween(Math.max(120, duration*0.6), () => {});
    }

    async function cmdTurn(sign, duration){
      const start = state.angle;
      const end = state.angle + sign * STEP_TURN_DEG;
      await tween(Math.max(160, duration*0.8), e => { state.angle = start + (end-start)*e; });
    }

    // Sequencer
    async function runSequence(seq, duration){
      if (!seq.length) { status("No valid commands found.", 'warn'); return; }
      status(`Running ${seq.length} command${seq.length>1?'s':''}…`, 'info');
      runBtn.disabled = true; input.disabled = true; resetBtn.disabled = true;

      for (let i=0;i<seq.length;i++){
        const ch = seq[i];
        status(`Step ${i+1}/${seq.length}: “${ch}”`, 'info');
        if (ch==='a')      await cmdForward(duration);
        else if (ch==='b') await cmdStop(duration);
        else if (ch==='c') await cmdTurn(+1, duration);
        else if (ch==='d') await cmdTurn(-1, duration);
        else if (ch==='e') {await animateWings(!state.wingsExtended, Math.max(140, duration*0.7));
		await animateWings(!state.wingsExtended, Math.max(140, duration*0.7));}
      }

      status('Done! ✨', 'success');
      runBtn.disabled = false; input.disabled = false; resetBtn.disabled = false;
    }

    function status(text, kind='info'){
      const color = kind==='success'? 'var(--success)' : kind==='warn'? 'var(--warn)' : 'var(--accent)';
      statusEl.innerHTML = `<span style="color:${color}">●</span> ${text}`;
    }

    // UI wiring
    dur.addEventListener('input', () => { durLabel.textContent = `${dur.value} ms`; });

    runBtn.addEventListener('click', async () => {
      const raw = input.value.trim();
      const clean = raw.toLowerCase();
      const unknown = clean.replace(/[abcde]/g, '');
      const seq = clean.match(/[abcde]/g) || [];
      if (unknown.length) {
        status(`Ignoring unknown character(s): ${[...new Set(unknown.split(''))].join(', ')}`, 'warn');
      }
      await runSequence(seq, parseInt(dur.value,10));
    });

    resetBtn.addEventListener('click', () => {
      state.x = view.W/2; state.y = view.H/2; state.angle = 0; animateWings(false, 160);
      render();
      status('Reset. Enter commands and press Run.');
    });

    // Allow pressing Enter to run
    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') runBtn.click(); });

    // First render
    render();
  </script>
</body>
</html>
